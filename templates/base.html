{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basira</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary-navy: #1a237e;
            --text-dark: #1e293b;
            --border-light: #E5E7EB;
            --text-muted: #64748b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #FFFFFF;
            color: var(--text-dark);
            min-height: 100vh;
            font-size: 1rem;
        }

        .custom-navbar {
            display: flex;
            width: 100%;
            height: 70px;
            padding: 0 20px; 
            background: #FFFFFF;
            border-bottom: 1px solid var(--border-light);
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .brand-name {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--primary-navy);
            letter-spacing: -0.5px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-link-custom {
            text-decoration: none !important;
            color: var(--text-dark);
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.2s ease;
            padding: 6px 14px;
            border-radius: 8px;
            border: 2px solid transparent;
            display: inline-block;
        }

        .nav-link-custom:hover {
            color: var(--primary-navy) !important;
            background-color: rgba(26, 35, 126, 0.05);
        }

        .nav-active {
            color: var(--primary-navy) !important;
            background-color: rgba(26, 35, 126, 0.08);
            position: relative;
        }

        .nav-active::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 20%;
            right: 20%;
            height: 3px;
            background: var(--primary-navy);
            border-radius: 10px;
        }

        /* HIGH CONTRAST USER DROPDOWN */
        .user-dropdown-btn {
            background: none;
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            color: var(--text-dark);
            padding: 8px 16px;
            border-radius: 10px;
            transition: all 0.2s ease-in-out;
        }
        
        .user-dropdown-btn:hover {
            background-color: #f1f5f9; /* High contrast background */
            color: var(--primary-navy);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .user-dropdown-btn i.bi-person-circle {
            color: var(--text-muted);
            transition: color 0.2s;
        }

        .user-dropdown-btn:hover i.bi-person-circle {
            color: var(--primary-navy);
        }

        .user-dropdown-btn::after { display: none; }

        .dropdown-item-danger {
            color: #ef4444 !important;
            font-weight: 700;
            padding: 10px 20px;
            transition: all 0.2s;
        }
        
        .dropdown-item-danger:hover {
            background-color: #dc2626 !important; /* Maximum contrast red */
            color: white !important;
        }

        .ai-consultant-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
            text-decoration: none;
        }

        .ai-consultant-btn:hover { transform: scale(1.1); }

        .alert-container {
            position: absolute;
            top: 80px;
            width: 100%;
            padding: 0 5%;
            z-index: 999;
        }
    </style>
</head>
<body>
    
    <nav class="custom-navbar">
        <a href="{% url 'home' %}" class="nav-left">
            <div class="nav-logo-svg">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="40" viewBox="0 0 30 40" fill="none">
                    <path d="M19.3917 0.371545C19.4552 0.387386 19.5187 0.403227 19.5842 0.419549C22.2321 1.09164 24.2685 2.83166 26.211 4.90947C26.5355 5.2528 26.8717 5.56933 27.2238 5.87563C29.2936 7.6802 29.2936 7.6802 29.495 8.86422C29.5961 10.1152 29.376 11.1144 28.6802 12.0951C27.1588 14.0973 24.5131 15.0738 22.2434 15.326C22.0058 15.3398 21.7685 15.3433 21.5305 15.3448C21.464 15.3453 21.3975 15.3458 21.329 15.3464C21.1887 15.3473 21.0485 15.3479 20.9083 15.3482C20.6982 15.3491 20.4882 15.352 20.2781 15.3549C17.8933 15.3722 15.8216 14.4478 14.0247 12.684C13.9943 12.642 13.964 12.6 13.9327 12.5567C13.9582 12.3086 13.9582 12.3086 14.0142 12.0951C14.4172 12.0815 14.7671 12.1253 15.159 12.23C15.2684 12.2586 15.3778 12.2871 15.4872 12.3156C15.5435 12.3305 15.5999 12.3455 15.658 12.3608C19.1981 13.2924 22.8903 13.174 26.0729 10.9874C26.6729 10.5453 26.6729 10.5453 27.0506 9.87965C27.0322 9.58906 27.0077 9.45885 26.8173 9.25763C26.7186 9.1857 26.7186 9.1857 26.6178 9.11231C26.5437 9.05698 26.4697 9.00165 26.3934 8.94464C26.3145 8.88764 26.2357 8.83064 26.1544 8.77191C24.4366 7.51102 24.4366 7.51102 23.7508 6.6949C21.9831 4.59676 19.4635 3.31066 16.915 3.19589C15.2563 3.1662 13.5597 3.7963 12.3371 5.08517C10.9797 6.58216 10.1953 8.60179 10.1609 10.7463C10.1505 12.5753 10.4551 14.0163 11.602 15.3733C11.9226 15.7202 12.248 15.9928 12.6291 16.2492C12.6778 16.2823 12.7265 16.3154 12.7766 16.3495C14.7625 17.6774 17.0477 18.3481 19.2342 19.1183C24.9674 21.1386 24.9674 21.1386 26.9692 23.1725C27.0133 23.2173 27.0574 23.2621 27.1028 23.3083C28.6516 24.9061 29.8768 27.1387 29.994 29.5672C30.0696 32.3524 29.4406 34.8288 27.7381 36.8838C25.8793 39.0355 23.2615 39.9479 20.661 39.9995C18.4425 40.0184 16.4548 39.5343 14.5031 38.3117C14.4043 38.2521 14.3055 38.1926 14.2067 38.1332C13.5174 37.711 12.9057 37.2131 12.3032 36.6501C12.2319 36.5836 12.2319 36.5836 12.1592 36.5157C11.2981 35.7071 10.5024 34.8472 9.77734 33.8807C9.70186 33.7815 9.62632 33.6823 9.55073 33.5832C9.17294 33.087 8.79768 32.5893 8.43296 32.0806C6.5512 29.4655 4.5859 27.2327 1.4666 26.865C1.00537 26.8239 0.543621 26.7965 0.0814778 26.7727C0.0216426 26.57 0.0216426 26.57 0 26.3111C0.648878 25.1078 1.85514 24.5493 3.00577 24.2111C4.99997 23.7567 7.08987 24.2682 8.79961 25.4803C9.89474 26.31 10.8725 27.3727 11.7325 28.4996C13.823 31.2098 16.3565 33.6895 19.6605 33.9901C21.0092 34.0775 22.2126 33.8107 23.3638 32.9807C23.9974 32.2628 24.3015 31.4831 24.316 30.4767C24.3071 29.4025 23.9711 28.6377 23.3027 27.8804C21.7072 26.3902 19.6014 25.6664 17.6717 24.9385C14.2126 23.6313 10.85 22.2641 8.14778 19.3878C8.07437 19.3135 8.07437 19.3135 7.99947 19.2378C6.80291 17.9767 6.02566 16.1714 5.62197 14.4029C5.59603 14.3008 5.57009 14.1987 5.54336 14.0935C4.91369 11.2334 5.54151 8.12823 6.83001 5.62583C8.29524 2.91089 10.6786 1.16002 13.3624 0.371545C15.2511 -0.123908 17.5026 -0.123788 19.3917 0.371545Z" fill="#1E3A8A"/>
                    <path d="M20.2213 5.97956C20.3268 6.04488 20.4307 6.11372 20.5319 6.18726C20.6428 6.26723 20.6428 6.26723 20.756 6.34881C21.2095 6.86264 21.4391 7.40529 21.4536 8.13158C21.4451 8.99778 21.2189 9.63919 20.6949 10.2713C20.0514 10.9121 19.3993 11.04 18.5634 11.0188C17.9802 10.9604 17.5514 10.6988 17.1557 10.2144C16.6734 9.48843 16.6231 8.84062 16.7024 7.94118C16.875 7.15915 17.3541 6.53017 17.945 6.10072C18.575 5.67957 19.545 5.64899 20.2213 5.97956Z" fill="#1E3A8A"/>
                </svg>
            </div>
            <span class="brand-name">Basira</span>
        </a>

        <div class="nav-right">
            <a href="{% url 'home' %}" class="nav-link-custom {% if request.resolver_match.url_name == 'home' %}nav-active{% endif %}">Home</a>
            
            {% if user.is_authenticated %}
                <a href="{% url 'history' %}" class="nav-link-custom {% if request.resolver_match.url_name == 'history' %}nav-active{% endif %}">History</a>
                
                <div class="dropdown">
                    <a class="nav-link-custom dropdown-toggle {% if request.resolver_match.url_name == 'scrape' or request.resolver_match.url_name == 'research_dashboard' %}nav-active{% endif %}" 
                       href="#" role="button" data-bs-toggle="dropdown">
                        <span>Scrape</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                        <li><a class="dropdown-item" href="{% url 'scrape' %}">Scrape Website</a></li>
                        <li><a class="dropdown-item" href="{% url 'research_dashboard' %}">Scrape Articles</a></li>
                    </ul>
                </div>

                <a href="{% url 'chat_home' %}" class="ai-consultant-btn" title="AI Consultant">
                    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 55 55" fill="none">
                        <circle cx="27.5" cy="27.5" r="27.5" fill="url(#nav_gradient)"/>
                        <path d="M13 16.3333V42.6548C13 43.3972 13.8976 43.769 14.4226 43.244L20.8452 36.8215C21.1577 36.509 21.5817 36.3333 22.0237 36.3333H39.6667C41.5077 36.3333 43 34.841 43 33V16.3333C43 14.4924 41.5077 13 39.6667 13H16.3333C14.4924 13 13 14.4924 13 16.3333Z" stroke="white" stroke-width="3.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M33 28C31.6675 29.0373 29.917 29.6667 28 29.6667C26.083 29.6667 24.3325 29.0373 23 28" stroke="white" stroke-width="3.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M23 21.3669V21.3335" stroke="white" stroke-width="3.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M33 21.3669V21.3335" stroke="white" stroke-width="3.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <defs>
                            <linearGradient id="nav_gradient" x1="27.5" y1="0" x2="27.5" y2="55" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#101828"/>
                                <stop offset="1" stop-color="#1C398E"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </a>

                <div class="dropdown">
                    <button class="user-dropdown-btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle fs-5"></i>
                        <span>{{ user.username }}</span>
                        <i class="bi bi-chevron-down small opacity-50"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2 p-2" style="min-width: 180px; border-radius: 12px;">
                        <li>
                            <form action="{% url 'logout' %}" method="post" id="logout-form">
                                {% csrf_token %}
                                <button type="submit" class="dropdown-item dropdown-item-danger d-flex align-items-center gap-2 rounded-3">
                                    <i class="bi bi-box-arrow-right"></i> Logout
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>

            {% else %}
                <a href="{% url 'login' %}" class="nav-link-custom {% if request.resolver_match.url_name == 'login' %}nav-active{% endif %}">Login</a>
                <a href="{% url 'register' %}" class="nav-link-custom" style="background: var(--primary-navy); color: white; padding: 10px 24px; border-radius: 8px;">Get Started</a>
            {% endif %}
        </div>
    </nav>

    <div class="alert-container">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    </div>

    <main class="flex-grow-1">
        {% block content %}
        {% endblock %}
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>